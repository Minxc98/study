# db  tb split  #
深入了解
1、基本使用、原理
2、不足、对比
3、优化点、坑



## 目录大纲 ##
#### 背景

#### 问题挑战

#### 分库策略

#### 方案选择

#### 业务实践

#### 注意事项

#### Q&A



## 背景 ##
业务增长块，数据量剧增

单库单表性能瓶颈



## 困难挑战

- 常规挑战

  1. 跨库查询
  2. 数据库事务
  3. 程序复杂性
  4. 数据扩容
  5. 性能问题


- 挑战

  1. 表调整
2. 影响面广
  3. 平滑迁移



## 分库分表策略

### 分库方式

垂直 VS 水平

水平分库

垂直分库

水平分表

垂直分表

#### 差异点

- 垂直

表 n => 1 库

数据无交集

同一个表 取并集为全量数据

- 水平

表 n <=> m 库

数据无交集

取所有库下的所有表数据 为全量数据

#### 优缺点

垂直

- 优点





- 缺点

表数据量问题



### 分片键值 ###

key的选择

订单类：order_id



### 分片算法 ###

hash

range

range + hash




## 方案对比 ##
star、迭代频率、团队、优点（性能、方便、成本）、不足（限制、）

列一个表格？



数据库代理

MyCat

kingSharding

Atlas

Fabric

mysql_proxy



数据库中间件

DAL

Sharding-JDBC

TDDL



方案选定的理由：

公司大环境、部门环境、
灵活度、拓展性
实现复杂度等
上手快！Mybatis
无浸入

## 业务实践 ##

### 新库新表

新的数据库、新的表结构

自增主键 -> 分布式唯一ID

### 服务收口

规范结构

数据库代理

服务依赖关系图

埋点监控（耗时统计）

### 平滑过渡 ###
过渡时期

双写

双读

Aop + Event + job

数据迁移

job

### 常见查询？

直接查找

二分查找



### 离线查询

宽表

order-velocity

### 数据库事务？

二分查找

### 数据库事务？

二分查找

## Tips

MyBatis Generator 逻辑表

update 不能更新 key 

调试配置

Shariding-JDBC 不支持 like 语句中包含分片键







## Q&A







