# study-activemq #
ActiveMQ学习笔记

## 参考链接 ##
- 官网 [http://activemq.apache.org/getting-started.html](http://activemq.apache.org/getting-started.html)
- 消息中间件（一）MQ详解及四大MQ比较 [https://blog.csdn.net/wqc19920906/article/details/82193316](https://blog.csdn.net/wqc19920906/article/details/82193316)
- mq的基本介绍和基本用法 [https://blog.csdn.net/qq_20009015/article/details/81409346](https://blog.csdn.net/qq_20009015/article/details/81409346)
- Kafka基本介绍 https://www.cnblogs.com/qingyunzong/p/9004509.html

## Java使用入门 ##
### 参考项目 ###
    \apache-activemq-5.15.4\examples
    \apache-activemq-5.15.4\examples\amqp\java

## 组成 ##

### Broker(中间人) ###
消息服务器，作为server提供消息核心服务

### Producer ###
消息生产者，业务的发起方，负责生产消息传输给broker，

### Consumer ###
消息消费者，业务的处理方，负责从broker获取消息并进行业务逻辑处理

### Topic ###
主题，发布订阅模式下的消息统一汇集地，不同生产者向topic发送消息，由MQ服务器分发到不同的订阅者，实现消息的广播

### Queue ###
队列，PTP模式(点对点)下，特定生产者向特定queue发送消息，消费者订阅特定的queue完成指定消息的接收

### Message ###
消息体，根据不同通信协议定义的固定格式进行编码的数据包，来封装业务数据，实现消息的传输

## 消息模式 ##
### Topic/主题模式 ###
假如发布者发布了100条消息，那么如果有n个订阅者，每个订阅者都可以获取到100条消息。即订阅者可以获取到所有的消息（但如果订阅是在主题发布消息之后，则获取不到任何消息，只能获取到订阅时间之后主题的发布的消息，比如说A订阅了B, B发布了消息，C再订阅了B,那么只有a能够获取到消息，C不能，因为它的订阅行为发生在B发布消息之后）

### 队列模式 ###
假如生产者发送了100条消息，如果有n个消费者，那么每个订阅者加起来获取到的消息总数是100。
没有时间上限制。只要队列中有消息，消费者可以任意时间去取消息，一个消息只能被一个消费者消费。

## 应用场景 ##
### 异步通信 ###
有些业务不想也不需要立即处理消息。消息队列提供了异步处理机制，允许用户把一个消息放入队列，但并不立即处理它。想向队列中放入多少消息就放多少，然后在需要的时候再去处理它们。

### 解耦 ###
降低工程间的强依赖程度，针对异构系统进行适配。在项目启动之初来预测将来项目会碰到什么需求，是极其困难的。通过消息系统在处理过程中间插入了一个隐含的、基于数据的接口层，两边的处理过程都要实现这一接口，当应用发生变化时，可以独立的扩展或修改两边的处理过程，只要确保它们遵守同样的接口约束。

### 冗余 ###
有些情况下，处理数据的过程会失败。除非数据被持久化，否则将造成丢失。消息队列把数据进行持久化直到它们已经被完全处理，通过这一方式规避了数据丢失风险。许多消息队列所采用的”插入-获取-删除”范式中，在把一个消息从队列中删除之前，需要你的处理系统明确的指出该消息已经被处理完毕，从而确保你的数据被安全的保存直到你使用完毕。

### 扩展性 ###
因为消息队列解耦了你的处理过程，所以增大消息入队和处理的频率是很容易的，只要另外增加处理过程即可。不需要改变代码、不需要调节参数。便于分布式扩容。

### 过载保护 ###
在访问量剧增的情况下，应用仍然需要继续发挥作用，但是这样的突发流量无法提取预知；如果以为了能处理这类瞬间峰值访问为标准来投入资源随时待命无疑是巨大的浪费。使用消息队列能够使关键组件顶住突发的访问压力，而不会因为突发的超负荷的请求而完全崩溃。

### 可恢复性 ###
系统的一部分组件失效时，不会影响到整个系统。消息队列降低了进程间的耦合度，所以即使一个处理消息的进程挂掉，加入队列中的消息仍然可以在系统恢复后被处理。

### 顺序保证 ###
在大多使用场景下，数据处理的顺序都很重要。大部分消息队列本来就是排序的，并且能保证数据会按照特定的顺序来处理。

### 缓冲 ###
在任何重要的系统中，都会有需要不同的处理时间的元素。消息队列通过一个缓冲层来帮助任务最高效率的执行，该缓冲有助于控制和优化数据流经过系统的速度。以调节系统响应时间。

### 数据流处理 ###
分布式系统产生的海量数据流，如：业务日志、监控数据、用户行为等，针对这些数据流进行实时或批量采集汇总，然后进行大数据分析是当前互联网的必备技术，通过消息队列完成此类数据收集是最好的选择。或解决的问题就是发送到队列的消息能否重复消费(多订阅)。

## 不足 ##
### 系统可用性降低 ###
你想啊，本来其他系统只要运行好好的，那你的系统就是正常的。现在你非要加个消息队列进去，那消息队列挂了，你的系统不是呵呵了。因此，系统可用性降低
### 系统复杂性增加 ###
要多考虑很多方面的问题，比如一致性问题、如何保证消息不被重复消费，如何保证保证消息可靠传输。因此，需要考虑的东西更多，系统复杂性增大。
### 延时增加 ###
消息传递路径更长，延时会增加
### 可靠性和重复性矛盾 ###
消息可靠性和重复性互为矛盾，消息不丢不重难以同时保证
### 结果返回 ###
上游无法知道下游的执行结果